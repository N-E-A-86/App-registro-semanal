<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Trabajo Remoto</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Favicon opcional -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Dashboard de Trabajo Remoto</h1>
            <p>Registra tus horas, planifica tu semana y sigue tu progreso</p>
        </header>

        <main class="main-content">
            <!-- Secci√≥n de Registro de Horas -->
            <section class="card horas-trabajo">
                <h2>Registro de Horas</h2>
                <form id="formulario-horas">
                    <div class="form-group">
                        <label for="fecha">Fecha</label>
                        <input type="date" id="fecha" required />
                    </div>
                    <div class="form-group">
                        <label for="hora-entrada">Hora de Entrada</label>
                        <input type="time" id="hora-entrada" required />
                    </div>
                    <div class="form-group">
                        <label for="hora-salida">Hora de Salida</label>
                        <input type="time" id="hora-salida" required />
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Horas</button>
                </form>

                <div class="resumen-horas">
                    <h3>Resumen Semanal</h3>
                    <p>Total de horas esta semana: <span id="total-horas">0</span></p>
                </div>

                <div class="historial-horas">
                    <h3>Historial Semanal</h3>
                    <ul id="lista-horas" class="lista-horas">
                        <li class="registro-hora"><em>Sin registros a√∫n.</em></li>
                    </ul>
                </div>

                <!-- Enlace para mostrar historial mensual -->
                <div class="enlace-historial">
                    <button type="button" class="btn-link" onclick="toggleHistorialMensual()">
                        ‚ñ∂ Historial Mensual
                    </button>
                </div>

                <!-- Contenedor oculto del historial mensual -->
                <div id="contenedor-historial-mensual" class="historial-mensual oculto">
                    <p>Registros del mes actual</p>
                    <ul id="lista-historial-mensual" class="lista-horas">
                        <!-- Generado din√°micamente -->
                    </ul>
                </div>
            </section>

            <!-- Secci√≥n de Plan de Acci√≥n Semanal -->
            <section class="card plan-accion">
                <h2>Plan de Acci√≥n Semanal</h2>
                <form id="formulario-plan">
                    <div class="form-group">
                        <label for="tarea">Nueva Tarea</label>
                        <input type="text" id="tarea" placeholder="Escribe una tarea..." required />
                    </div>
                    <div class="form-group">
                        <label for="prioridad">Prioridad</label>
                        <select id="prioridad">
                            <option value="baja">Baja</option>
                            <option value="media">Media</option>
                            <option value="alta">Alta</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Agregar Tarea</button>
                </form>

                <ul id="lista-tareas" class="tareas-lista">
                    <!-- Generado din√°micamente -->
                </ul>
            </section>

            <!-- Secci√≥n de Indicador de Progreso -->
            <section class="card progreso">
                <h2>Indicador de Progreso</h2>
                <div class="progreso-contenedor">
                    <svg class="progreso-circular" width="150" height="150" viewBox="0 0 150 150">
                        <circle class="fondo-circular" cx="75" cy="75" r="60" />
                        <circle class="progreso-circular-fill" cx="75" cy="75" r="60" />
                    </svg>
                    <div class="porcentaje">
                        <span id="porcentaje-progreso">0%</span>
                    </div>
                </div>
                <p>Completaste <span id="tareas-completadas">0</span> de <span id="total-tareas">0</span> tareas</p>
            </section>
        </main>

        <footer class="footer">
            <p>&copy; 2025 Registro de Trabajo Remoto. Arrua Nicolas Todos los derechos reservados.</p>
        </footer>
    </div>

    <!-- Firebase SDK: Compatibility Mode (v9+) -->
    <!-- Corregido: Eliminados los espacios extras al final de las URLs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
        // Tu configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAOT2ZR3L0LI8oVfQPnIKzgWhU4sjlXS1o",
            authDomain: "mi-dashboard-trabajo.firebaseapp.com",
            projectId: "mi-dashboard-trabajo",
            storageBucket: "mi-dashboard-trabajo.firebasestorage.app",
            messagingSenderId: "507126195570",
            appId: "1:507126195570:web:674dacc7f66c45eb9b29eb"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtener instancia de Firestore (en modo compatibilidad)
        const db = firebase.firestore();

        // ID √∫nico para compartir datos (puedes cambiarlo)
        const userId = 'supervisor-acceso'; // Todos ven lo mismo

        // Cargar datos desde Firestore
        async function cargarDatos() {
            try {
                const doc = await db.collection('usuarios').doc(userId).get();
                if (doc.exists) {
                    const data = doc.data();
                    window.horasTrabajadas = data.horasTrabajadas || [];
                    window.tareas = data.tareas || [];
                    console.log("‚úÖ Datos cargados de la nube:", data);
                } else {
                    console.log("üì≠ No hay datos. Iniciando vac√≠o.");
                    window.horasTrabajadas = [];
                    window.tareas = [];
                }
                // Notificar que los datos est√°n listos
                document.dispatchEvent(new Event('datosCargados'));
            } catch (e) {
                console.error("‚ùå Error al cargar de Firestore:", e);
                window.horasTrabajadas = [];
                window.tareas = [];
                document.dispatchEvent(new Event('datosCargados'));
            }
        }

        // Guardar datos en Firestore
        async function guardarDatos() {
            if (!window.horasTrabajadas || !window.tareas) return;
            try {
                await db.collection('usuarios').doc(userId).set({
                    horasTrabajadas: window.horasTrabajadas,
                    tareas: window.tareas,
                    updatedAt: new Date()
                });
                console.log("‚úÖ Datos guardados en la nube");
            } catch (e) {
                console.error("‚ùå Error al guardar en Firestore:", e);
            }
        }

        // Cargar al iniciar
        cargarDatos();
    </script>

    <!-- Tu script principal -->
    <script src="script.js"></script>

    <script>
        // Asegurar que guardarDatos() est√© disponible globalmente
        window.guardarDatos = guardarDatos;
    </script>
</body>
</html>